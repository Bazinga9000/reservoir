{% extends "puzzles/base.html" %}

{% block title %}‚Ñùeservoir - {{ hunt.name }}{% endblock %}
{% block nav-left %}
<a href="/">Hunts</a> > <b>{{ hunt.name }}</b>
{% endblock %}
{% block content %}
<center>
<h1>{{ hunt.name }}</h1>
<div class="total_count countbox"><div class="icon">{% include 'puzzles/icons/puzzle.svg' %}</div><span class="bigboard_number">{{ hunt.total_puzzles }}</span><br>Total Puzzles</div>
<div class="locked_count countbox"><div class="icon">{% include 'puzzles/icons/lock.svg' %}</div><span class="bigboard_number">{{ hunt.num_locked }}</span><br>Locked Puzzles</div>
<div class="solved_count countbox"><div class="icon">{% include 'puzzles/icons/check.svg' %}</div><span class="bigboard_number">{{ hunt.num_solved }}</span><br> Solved Puzzles</div>
<div class="open_count countbox"><div class="icon">{% include 'puzzles/icons/target.svg' %}</div><span class="bigboard_number">{{ hunt.num_available }}</span><br>Avaliable Puzzles</div>
<div class="meta_count countbox"><div class="icon">{% include 'puzzles/icons/layers.svg' %}</div><span class="bigboard_number">{{ hunt.meta_solves }}</span><br>Meta Solves</div>
</center>

{% for round in hunt.round_set.all %}
<div class="round_info">
    <center><h2>{{ round.name }}</h2></center>
    <div class="puzzles_list">
    {% for puzzle in round.puzzles_ordered %}
    <a href="{% url 'puzzles:puzzlepage' puzzle.id %}" title="Priority: {{ puzzle.priority }}"><div class="puzzle_info status_{{ puzzle.status }}{% if puzzle.is_meta %} meta_info{% endif %}">
        <center><span class="puzzle_name">{% if puzzle.is_meta %}META: {% endif %}{{ puzzle.name }}</span></center>
        {% if puzzle.answer_set.all %}
        <div class="answer_line"></div>
        <center><span class="answer">
        {{ puzzle.answer_set.all| join:", "}}
        </span></center>
        {% endif %}
    </div></a>
    {% endfor %}
    <span class="new_puzzle_icon"><a onclick="showForm('new_puzzle_form', '{{ round.id }}')">{% include 'puzzles/icons/plus.svg' %}</a></span>
    </div>
</div>
{% endfor %}
{% if hunt.roundless_puzzles %}
<div class="round_info">
    <center><h2><i>Puzzles With No Round</i></h2></center>
    <div class="puzzles_list">
    {% for puzzle in hunt.roundless_puzzles %}
    <a href="{% url 'puzzles:puzzlepage' puzzle.id %}"><div class="puzzle_info status_{{ puzzle.status }}{% if puzzle.is_meta %} meta_info{% endif %}">
        <center><span class="puzzle_name">{% if puzzle.is_meta %}META: {% endif %}{{ puzzle.name }}</span></center>
        {% if puzzle.answer_set.all %}
        <div class="answer_line"></div>
        <center><span class="answer">
        {{ puzzle.answer_set.all| join:", "}}
        </span></center>
        {% endif %}
        </div>
    </div></a>
    {% endfor %}
</div>
{% endif %}


<form autocomplete="off" action="{% url 'puzzles:new_round' hunt.id %}" method="post">
{% csrf_token %}
<label for="new_round">Add New Round</label>
<input class="new_round" name="new_round" maxlength="255"></input>
<button type="submit">Add New Round</button>
</form>

<div class="popup_form" id="new_puzzle_form">
        <form autocomplete="off" action="{% url 'puzzles:new_puzzle' hunt.id %}" method="post">
            {% csrf_token %}
            <fieldset>
                <legend><h3>New Puzzle</h3></legend>
                {{ new_puzzle_form }}
                <button class="cancel_button" onclick="closeForm('new_puzzle_form')" type="button">Cancel</button>
                <button class="submit_button" onclick="closeForm('new_puzzle_form')" type="submit">New Puzzle</button>
            </fieldset>
        </form>
    </div>


<script>
    function showForm(formId, select_id) {
      // Get all forms
      var forms = document.querySelectorAll('.new_puzzle_form');
      // Loop through forms and hide them
      forms.forEach(function(form) {
        form.style.display = 'none';
      });
      // Show the selected form
      var selectedForm = document.getElementById(formId);
      if (selectedForm) {
        selectedForm.style.display = 'block';

        if (select_id) {
            round_select = selectedForm.querySelector("#id_rounds")
            round_select.value = [select_id]
        }

      }
    }

    function closeForm(formId) {
      var selectedForm = document.getElementById(formId);
      if (selectedForm) {
        selectedForm.style.display = 'none';
      }
    }
</script>
{% endblock %}