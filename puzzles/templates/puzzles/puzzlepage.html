{% extends "puzzles/base.html" %}

{% block title %}‚Ñùeservoir - {{ puzzle.name }}{% endblock %}
{% block nav-left %}
<a href="/">Hunts</a> > <a href="{% url 'puzzles:bigboard' puzzle.hunt.id %}">{{ puzzle.hunt.name }}</a> > <b>{{ puzzle.name }}</b>
{% endblock %}
{% block content %}
<h1>{% if puzzle.is_meta %}<span class="meta_name"><b>META</b></span>{% endif %}{{ puzzle.name }}</h1>
<h2>Round{{puzzle.rounds.all.count|pluralize}}: {{ puzzle.rounds.all| join:", "}}</h2>
<button onclick="showForm('update_puzzle_form')">Update Details</button>

<iframe src="{{ puzzle.url }}", width="100%" height="100%"></iframe>
<iframe src="{{ puzzle.sheet_url }}", width="100%" height="100%"></iframe>

<div class="popup_form" id="update_puzzle_form">
<form autocomplete="off" action="{% url 'puzzles:update' puzzle.id %}" method="post">
{% csrf_token %}
<fieldset>
    <legend><h3>Puzzle Details</h3></legend>
    {% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}
    {{ update_puzzle_form }}
    {% if puzzle.answer_set.all %}
    Answer{{puzzle.answer_set.all.count|pluralize}}:<br>
    {% for answer in puzzle.answer_set.all %}
    <span class="answer">
    {{ answer.answer_text }}
    </span>  Delete: <input type="checkbox" id="delete_answer_{{ answer.id }}" name="delete_answer_{{ answer.id }}" value="Delete">
    <br>
    {% endfor %}
    {% endif %}
    <button class="cancel_button" onclick="closeForm('update_puzzle_form')">Cancel</button>
    <button class="submit_button" onclick="closeForm('update_puzzle_form')" type="submit">Update</button>
</fieldset>
</form>
<script>
    function showForm(formId) {
      // Get all forms
      var forms = document.querySelectorAll('.popup_form');
      // Loop through forms and hide them
      forms.forEach(function(form) {
        form.style.display = 'none';
      });
      // Show the selected form
      var selectedForm = document.getElementById(formId);
      if (selectedForm) {
        selectedForm.style.display = 'block';
      }
    }

    function closeForm(formId) {
      var selectedForm = document.getElementById(formId);
      if (selectedForm) {
        selectedForm.style.display = 'none';
      }
    }
</script>
{% endblock %}